# Tasks - 📰 Substack Daily

## Phase 0: 初始化

### T0.1 创建项目与环境
- 在 Cursor 中创建新项目 `substack-daily`
- 选择模板：**Next.js + TailwindCSS**
- 在项目根目录初始化 git 仓库并推送到 GitHub  
  ```bash
  git init
  git add .
  git commit -m "init Substack Daily MVP"
  git branch -M main
  git remote add origin https://github.com/你的用户名/substack-daily.git
  git push -u origin main
  ```

验收：
- [ ] 本地运行 `npm run dev` 可访问首页  
- [ ] 页面成功在浏览器显示  
- [ ] GitHub 仓库同步成功  

---

## Phase 1: 数据源与自动化

### T1.1 Supabase 数据库设置
- 在 supabase.com 创建项目  
- 新建表 `picks`  
  ```sql
  CREATE TABLE picks (
    id bigint generated by default as identity primary key,
    the_date date not null,
    kind text check (kind in ('daily', 'weekly')),
    items jsonb not null
  );
  ```
- 在 Supabase 仪表板获取：
  - `SUPABASE_URL`
  - `SUPABASE_ANON_KEY`

验收：
- [ ] 表创建成功  
- [ ] 控制台可手动插入一条 JSON 测试记录  
- [ ] 可在 Supabase UI 中查看记录  

---

### T1.2 n8n 自动化流程
- 本地或云端部署 n8n（推荐 n8n.io/cloud）  
- 创建新工作流 “Substack Daily Automation”：
  1. **Schedule Trigger**：每天中午 12:00 运行  
  2. **IF Node**：判断是否为周日  
  3. **OpenAI Node**：  
     - Prompt 说明：输出 3 篇（周一–六）或 5 篇（周日）Substack AI 相关文章  
     - 输出 JSON 格式：
       ```json
       [
         {"title":"","author":"","url":"","summary":"","reason":""}
       ]
       ```
  4. **Supabase Node**：  
     - 插入表 `picks`  
     - `the_date = {{$now.toISODate()}}`  
     - `kind = {{$json.length > 3 ? "weekly" : "daily"}}`  
     - `items = {{$json}}`

验收：
- [ ] 每天自动触发成功  
- [ ] Supabase 表中出现当天 JSON 数据  
- [ ] 周日切换为 weekly 5 篇模式正常  

---

## Phase 2: 前端开发

### T2.1 API 连接 Supabase
- 在 `.env.local` 添加：
  ```env
  NEXT_PUBLIC_SUPABASE_URL=你的_SUPABASE_URL
  NEXT_PUBLIC_SUPABASE_KEY=你的_SUPABASE_ANON_KEY
  ```
- 在 `/lib/supabaseClient.ts`：
  ```ts
  import { createClient } from '@supabase/supabase-js'

  export const supabase = createClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_KEY!
  )
  ```
- 在首页 `app/page.tsx`（或 `pages/index.tsx`）获取最新数据：
  ```ts
  import { supabase } from '@/lib/supabaseClient'

  export default async function Page() {
    const { data, error } = await supabase
      .from('picks')
      .select('*')
      .order('the_date', { ascending: false })
      .limit(1)
      .single()

    if (error) {
      return <div className="p-6 text-red-600">加载失败，请稍后重试。</div>
    }

    const items = (data?.items ?? []) as {
      title: string; author: string; url: string; summary: string; reason: string
    }[]

    const isWeekly = data?.kind === 'weekly'

    return (
      <main className="mx-auto max-w-5xl px-4 py-10">
        {/* Header */}
        <header className="flex items-center justify-between mb-10">
          <div className="text-2xl font-serif">Substack Daily</div>
          <nav className="flex gap-6 text-sm text-neutral-700">
            <a href="#today" className="hover:underline">今日推荐</a>
            <a href="#archive" className="hover:underline">历史归档</a>
            <a href="#about" className="hover:underline">关于</a>
          </nav>
        </header>

        {/* Hero */}
        <section id="today" className="mb-12">
          <h1 className="mb-6 text-3xl font-serif">
            {isWeekly ? '当周精选' : '今日精选'}
          </h1>

          {items.length > 0 && (
            <article className="rounded-2xl overflow-hidden bg-white shadow-sm">
              <img
                alt={items[0].title}
                className="w-full aspect-video object-cover transition-transform duration-300 hover:scale-105"
                src={`https://api.microlink.io?url=${encodeURIComponent(items[0].url)}`}
              />
              <div className="p-6">
                <h2 className="text-2xl font-serif mb-2">{items[0].title}</h2>
                <p className="text-sm text-neutral-600 mb-4">
                  {items[0].author} · {new Date(data!.the_date).toLocaleDateString()}
                </p>
                <p className="text-neutral-800 mb-4">{items[0].summary}</p>
                <a
                  href={items[0].url}
                  target="_blank"
                  className="inline-block rounded-full border px-4 py-2 text-sm hover:bg-black hover:text-white transition"
                >
                  阅读原文
                </a>
              </div>
            </article>
          )}
        </section>

        {/* Secondary */}
        <section className="grid md:grid-cols-2 gap-6 mb-12">
          {items.slice(1).map((it, idx) => (
            <article key={idx} className="rounded-2xl overflow-hidden bg-white shadow-sm">
              <img
                alt={it.title}
                className="w-full aspect-video object-cover transition-transform duration-300 hover:scale-105"
                src={`https://api.microlink.io?url=${encodeURIComponent(it.url)}`}
              />
              <div className="p-6">
                <h3 className="text-xl font-serif mb-2">{it.title}</h3>
                <p className="text-sm text-neutral-600 mb-3">{it.author}</p>
                <p className="text-neutral-800 line-clamp-3 mb-4">{it.summary}</p>
                <a href={it.url} target="_blank" className="inline-block text-sm underline">
                  阅读原文
                </a>
              </div>
            </article>
          ))}
        </section>

        {/* Footer */}
        <footer id="about" className="py-10 text-sm text-neutral-600">
          <p>关于本站：由 n8n + GPT + Supabase 自动生成的 AI/科技 Substack 精选。</p>
          <p className="mt-2">数据来源：Substack · 封面：Microlink API · 部署：Vercel</p>
        </footer>
      </main>
    )
  }
  ```

验收：
- [ ] 页面能正常加载最新文章数据  
- [ ] 封面图可见且加载稳定  
- [ ] 出错时显示友好提示  

---

### T2.2 视觉与动效（Tailwind）
- 在 `app/globals.css`（或 `styles/globals.css`）中添加基础色：
  ```css
  :root {
    --bg: #FAF9F6;
    --fg: #2E2E2E;
    --accent: #1A3E37;
  }
  html, body { background: var(--bg); color: var(--fg); }
  .card { transition: transform .3s ease, opacity .3s ease; }
  .card:hover { transform: scale(1.03); opacity: .98; }
  ```
- 在 `tailwind.config.ts` 增加字体：
  ```ts
  import type { Config } from 'tailwindcss'
  const config: Config = {
    theme: {
      extend: {
        fontFamily: {
          serif: ['"Playfair Display"', 'serif'],
          sans: ['Inter', 'system-ui', 'sans-serif'],
        },
        colors: {
          bg: '#FAF9F6',
          ink: '#2E2E2E',
          accent: '#1A3E37',
        }
      }
    }
  }
  export default config
  ```

验收：
- [ ] 背景色为 #FAF9F6，文字为 #2E2E2E，强调色 #1A3E37  
- [ ] hover 上浮与淡入动效正常  
- [ ] 移动端单列显示正常  

---

## Phase 3: 部署与上线

### T3.1 部署到 Vercel
- 登录 vercel.com 并导入 GitHub 仓库  
- 在项目 Settings → Environment Variables 添加：
  - `NEXT_PUBLIC_SUPABASE_URL`
  - `NEXT_PUBLIC_SUPABASE_KEY`
- 选择 `main` 分支自动部署

验收：
- [ ] 部署成功，访问网址可加载内容  
- [ ] 页面每日自动更新  
- [ ] 部署状态为绿色 ✅  

---

## ✅ 项目完成标准
- [ ] 每天自动写入 3 篇推荐（周日 5 篇）  
- [ ] 前端自动展示最新文章与封面图  
- [ ] 页面响应速度快且布局美观  
- [ ] 已部署在 Vercel，可公开访问  
- [ ] 无手动干预即可稳定运行  
